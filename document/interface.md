# 接口文档
> 日期：2016年 9月 26日 15点 10分

### 接口数据格式定义说明

S -> C(服务器到客户端)
C -> S(客户端到服务器)

### 资源的访问控制
* 静态资源
> 通过登录用户的session控制访问

* 服务接口
> 通过session验证[s]+sessionName
> 通过token验证[t]+tokenName+len
> 通过图片验证码验证[c]+codeName+len
> 通过邮件验证码验证[e]
> 不需要null验证[n]

### 接口格式
[
```
  {
    "describe":"",
    "name":"",
    "url":"/",
    "method":"",
    "security":[
      {"type":"","name":""}
    ],
    "arg":[
      {"name":""}
    ],
    "return":[
      {"type":"json","msg":{"code":1}}
    ]
  }
```
]

### 用户接口
---
####个人管理
---
登陆(未登录)
```
{
	name:/cyzm6/
	public/user/login,
	method:post,
    arg:[
        {name:email,type:string,max-len:128},
        {name:pwd,type:string,min-len:6,max-len:128},
        {name:code,type:string,length:6}
    ]
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:2}|
        {code:3}|
        {code:9}
    ]
}
```
注册(未登录)

```
{
    name:/cyzm6/public/user/register,
    method:post,
    arg:[
        {name:name,type:string,min-len:1,max-len:128},
        {name:pwd,type:string,min-len:6,max-len:128},
        {name:email,type:string},
        {name:age,type:int,range:0-150},
        {name:sex:,type:int,range:0-3},
        {name:code,type:string,length:6}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:4}
    ]
}
```

```
  {
    "describe":"用户个人信息获取",
    "name":"myinfo",
    "url":"/suser/private/user/user/myinfo",
    "method":"post",
    "security":[
      {"type":"session","name":"user"}
    ],
    "arg":[],
    "return":[
      {"type":"json","msg":{"code":0}},
      {"type":"json","msg":{"code":1,"data":{
        {"_id" : ObjectId(""),"name":"","type":"","email":"","sex":,"age":,"regist":,"remark":"","login":,"socket":}
      }}}
    ]
  }
```

修改密码(登录)
```
{
    name:/suser/private/user/modifypwd,
    method:post,
    arg:[
        {name:oldpwd,type:string,min-len:6,max-len:128},
        {name:newpwd,type:string,min-len:6,max-len:128}
    ],
    return:[
        {code:-1}|
        {code:1}|
        {code:3}
    ]
}
```
更换邮箱(登录)
```
发送请求得到验证码
{
    name:/suser/private/user/modifyemail1,
    method:post,
    return:[
        {code:-1}|
        {code:1}|
        {code:5}|
        {code:7}
    ]
}
填写验证码，并发送新的邮箱
{
    name:/suser/e/private/user/modifyemail2,
    method:post,
    arg:[
        {name:email,type:string},
        {name:mailcode,type:string}
    ]，
    return:[
        {code:-1}|
        {code:1}|
        {code:10}
    ]
}
```
密码找回(未登录)
```
1.发送找回请求
{
    name:/cyzm6/public/user/findpwd1,
    method:post,
    arg:[
        {name:email,type:string},
        {name:code,type:string,len:6}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:5}|
        {code:6}
    ]
}
2.成功后修改密码
{
    name:/smail/public/user/findpwd2,
    method:post,
    arg:[
        {name:newpwd,type:string,min-len:6,max-len:128},
        {name:code,type:string,len:6}
    ]
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:10}
    ]
}
```
---
修改个性签名(登录)
```
{
    name:/suser/private/user/modifysign,
    method:get,
    arg:[
        {name:words,type:string,min-len:1,max-len:128}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:7}
    ]
}
```
修改用户名(登录)
```
{
    name:/suser/private/user/modifyname,
    method:get,
    arg:[
        {name:name,type:string,min-len:1,max-len:128}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:7}
    ]
}
```
修改头像(登录)
```
{
    name:/suser/private/user/uploadhead,
    method:post,
    arg:[

        {name:head,type:base64-string,min-len=50,max-len:1024*256}

    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:7}|
        {code:12}
    ]
}
```
修改年龄(登录)
```
{
    name:/suser/private/user/modifyage,
    method:get,
    arg:[
        {name:age,type:int,min:0,max:200}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}
    ]
}
```
性别修改(登录)
```
{
    name:/suser/private/user/modifysex,
    method:get,
    arg:[
        {name:sex,type:int,min:0,max:2}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}
    ]
}
```
---
#### 好友管理
---
添加好友(登录)
```
{
    name:/suser/private/friend/add,
    method:get,
    arg:[
        {"name":"id","type":"string","describe":"用户的id"},
        {"name":"msg","type":"string","describe":"发送给用户的话","minlen":1,"maxlen":128}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:2}|
        {code:11}
    ]
}
{
    "describe":"申请添加好友确认",
    "name":"applygroup"
    "url":"/suser/private/friend/addcheck",
    "method":"post",
    "arg":[
        {"name":"fid","type":"string","describe":"好友id"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
```
好友搜索(登录)
```
以昵称的搜索方式
{
    name:/suser/private/friend/searchname,
    method:get,
    arg:[
        {name:name,type:string}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1,data:[{id:"",name:"","remark":""}]}
    ]
}
以用户ID的搜索方式(登录)
{
    name:/suser/private/friend/searchid,
    method:get,
    arg:[
        {name:id,type:string}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {"code":1,"data":{"_id":ObjectId(),"name":"","pwd":null,"type":1,"email":"","sex":0,"age":0,"regist":0,"remark":""}}
    ]
}
```
删除好友(登录)
```
{
    name:/suser/private/friend/delete,
    method:get,
    arg:[
        {"name":"id","type":"string","describe":"用户的id"},
        {"name":"msg","type":"string","describe":"发送给用户的话","minlen":1,"maxlen":128}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:10}
    ]
}
```
好友备注的修改(登录)
```
{
    name:/suser/private/friend/modifyrm,
    method:get,
    arg:[
        {name:fid,type:string}
        {name:nickname,type:string}
    ],
    return:[
        {code:-1}|
        {code:0}|
        {code:1}|
        {code:10}
    ]
}
```
获取好友列表信息(登录)
```
{
    name:/suser/private/friend/getlist,
    method:post,
    arg:[],
    return:[
        {code:-1}|
        {code:0}|
        {code:1,data:[{"_id":ObjectId(""),"name":"sw","pwd":null,"type":"1","email":"","sex":0,"age":21,"regist":0,"remark":"","socket":null}]}|
        {code:10}
    ]
}
```
---
#### 群管理
---
```
{
    "describe":"创建群组",
    "name":"creategroup"
    "url":"/suser/private/group/creategroup",
    "method":"post",
    "arg":[
        {"name":"name","type":"string","limit":"1,36"},
        {"name":"remark","type":"string","limit":"1,128"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1,"_id":ObjectId(""),"name":"","remark":"","datetime":"","owner":ObjectId("")},
        {"code":10}
    ]
}
{
    "describe":"群主删除群组",
    "name":"deletegroup"
    "url":"/suser/private/group/deletegroup",
    "method":"post",
    "arg":[
        {"name":"_id","type":"string","describe":"群组id"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
{
    "describe":"搜索群组(通过群id)|获取群组信息",
    "name":"searchgroupbyid"
    "url":"/suser/private/group/searchgroupbyid",
    "method":"post",
    "arg":[
        {"name":"gid","type":"string","describe":"群组id"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1,"group":{"_id":ObjectId(""),"name":"","remark":"","datetime":"","owner":ObjectId("")}},
        {"code":10}
    ]
}
{
    "describe":"搜索群组(通过群名称)",
    "name":"searchgroupbyname"
    "url":"/suser/private/group/searchgroupbyname",
    "method":"post",
    "arg":[
        {"name":"keyword","type":"string","limit":"1,10","describe":"关键词"},
        {"name":"page","type":"unsigned int","describe":"页码"},
        {"name":"size","type":"unsigned int","describe":"页面大小"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1,"groups":[{"_id":ObjectId(""),"name":"","remark":"","datetime":"","owner":ObjectId("")}]},
        {"code":10}
    ]
}
{
    "describe":"设置群组名称",
    "name":"setgroupname"
    "url":"/suser/private/group/setgroupname",
    "method":"post",
    "arg":[
        {"name":"gname","type":"string","describe":"群名称","limit":"1,36"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
{
    "describe":"设置群组备注",
    "name":"setgroupremark"
    "url":"/suser/private/group/setgroupremark",
    "method":"post",
    "arg":[
        {"name":"gremark","type":"string","limit":"1,128","describe":"群备注"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
{
    "describe":"设置群组头像",
    "name":"setgrouphead"
    "url":"/suser/private/group/setgrouphead",
    "method":"post",
    "arg":[
       {"name":"head","type":"base64"},
       {"name":"gid","type":"string","describe":"群id"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
{
    "describe":"获取群成员列表",
    "name":"getgroupmembers"
    "url":"/suser/private/group/getgroupmembers",
    "method":"post",
    "arg":[
        {"name":"id","type":"string","describe":"群组id"}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1,"members":[{"_id":ObjectId(""),"uid":ObjectId(""),"gid":ObjectId(""),"datetime":"","remark":""}]},
        {"code":10}
    ]
}
{
    "describe":"申请加入群组",
    "name":"applygroup"
    "url":"/suser/private/group/applygroup",
    "method":"post",
    "arg":[
        {"name":"id","type":"string","describe":"群主的id"},
        {"name":"gid","type":"string","describe":"群id"},
        {"name":"msg","type":"string","describe":"发送给群主的话","minlen":1,"maxlen":128}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
{
    "describe":"申请加入群组确认",
    "name":"applygroup"
    "url":"/suser/private/group/applygroupcheck",
    "method":"post",
    "arg":[
        {"name":"gid","type":"string","describe":"群id"},
        {"name":"uid","type":"string","describe":"用户id"},
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
{
    "describe":"成员退出群组",
    "name":"exitgroup"
    "url":"/suser/private/group/exitgroup",
    "method":"post",
    "arg":[
        {"name":"id","type":"string","describe":"群主的id"},
        {"name":"gid","type":"string","describe":"群id"},
        {"name":"msg","type":"string","describe":"发送给群主的话","minlen":1,"maxlen":128}
    ],
    "return":[
        {"code":-1},
        {"code":0},
        {"code":1},
        {"code":10}
    ]
}
```
### 系统接口
{
    "describe":"6位验证码接口",
    "name":"cyzm6",
    "url":"/public/api/cyzm6",
    "method":"get",
    "security":[],
    "server":[
        {"type":"session","name":""}
    ],
    "arg":[],
    "return":[
        {"type":"image/jpeg"}
    ]
}
{
    "describe":"4位验证码接口",
    "name":"cyzm4",
    "url":"/public/api/cyzm4",
    "method":"get",
    "arg":[],
    "return":[
        {"type":"image/jpeg"}
    ]
}
{
    "describe":"获取sessionid",
    "name":"sessionid",
    "url":"/suser/sessionid",
    "method":"get",
    "arg":[],
    "return":[
        {"code":7},
        {"code":1,"id":""}
    ]
}

