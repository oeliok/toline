<!DOCTYPE html>
<!--suppress HtmlUnknownTarget -->
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>聊天室</title>
    <script type="text/javascript" src="../js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="../js/index.js"></script>
    <script type="text/javascript" src="../dist/js/bootstrap.min.js"></script>
	<link href="../css/index.css" rel='stylesheet' type='text/css' />
	<link href="../dist/css/bootstrap.css" rel='stylesheet' type='text/css' />
    <script src="../js/template.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body style="margin: 0px;padding: 0px;
    background: url(../image/login-bg.png) center center / cover no-repeat
    fixed;height: 100%;">
<div class="allDiv">
	<div style="margin-right:-30px;">
		<div class="navBar row" style="background: url(../image/headerline.png) center center / cover no-repeat
	    fixed;height:100%;width: 100%;">
			<div class="col-md-1">
				<span class="changeToCircle"><img border="0" src="../image/Profile pic.png" alt="your profile picture" width="100" height="100" hspace="20" vspace="15"></span></div>
			<div class="col-md-2 col-md-offset-1"  style="margin-top: 22px;">
				<h2>
					<small style="color: white">昵称</small></h2>
			</div>
			<div class="col-md-1 col-md-offset-1 " >
				<img class="circular--square" src="../image/friendPic.png" alt="friend picture"  width="80" height="80"   hspace="5" vspace="25"></div>
			<div class="col-md-3 col-md-offset-1" style="margin-top: 22px;">
				<h1 >
					<small style="color: white">聊天室</small></h1>
			</div>
			<div class="col-md-1">
				<img onclick="paperBtn()" border="0" src="../image/Paper.png" alt="paper" width="30" height="30"  hspace="35" vspace="5" style="margin-top: 50px;margin-left: 20px;"></div>
			<div class="col-md-1">
				<img class="circular--square" onclick="settingBtn()" border="0" src="../image/Setting.png" alt="your profile picture" width="30" height="30"  hspace="35" vspace="5" style="margin-top: 50px;margin-left: 18px;"></div>
		</div>
	</div>
	<div class="row">
		<div class="friendList col-md-3"><!--
			<div class="row"> -->
			<div class="col-xs-6 col-sm-6">
				<img class="circular--square" border="0" src="../image/friendPic.png" alt="friend picture" width="80" height="80"  hspace="0"  vspace="25">
			</div>
			<div class="col-xs-6 col-sm-6" style="padding-top: 12px;">
				<h4 >
					<small style="color:#8aba56">遗世独立的理想乡</small></h4>
				<h4>
					<small style="color:#A9A9A9 ">水水水水</small></h4>
				<h4>
					<small style="color: black">2016.10.10</small></h4>
			</div>
			<!-- 	</div> -->
			<hr width="100%" >
		</div>
		<div class="chatList col-md-9">

			<div id="content" style="overflow:scroll;overflow-x: hidden; height: 80%;text-align: center;"></div>
			<script id="othersay" type="text/html">
				<div class="row">
					<div class="col-sm-2" >
						<img class="circular--square" border="0" src="../image/friendPic.png" alt="friend picture" width="80" height="80"  vspace="30">
					</div>
					<div class=" col-sm-10" style="padding-top: 12px;width: 64%;">
						<h4 style="text-align: left;">
							<small style="color:#8aba56;word-wrap: break-word;word-break: break-all;">{{user}}</small> <small style="color: black">{{date}}</small></h4>

						<p style="color: black;background-color: #f1f5f8;padding: 10px;border-radius: 8px;">{{msg}}</p>
					</div>
				</div>
			</script>
			<script id="mysay" type="text/html">
				<div class="row">
					<div class="col-sm-2"></div>
					<div class="col-sm-10" style="padding-top: 12px;width: 64%;">
						<h4 style="text-align: right;">
							<small style="color: black";word-wrap: break-word;word-break: break-all;>{{date}}</small><small style="color:#8aba56">{{user}}</small> </h4>

						<p style="color: black;background-color: #f1f5f8;padding: 10px;border-radius: 8px;">{{msg}}</p>
					</div>
					<div class="col-sm-2">
						<img class="circular--square" border="0" src="../image/friendPic.png" alt="friend picture" width="80" height="80"  vspace="30">
					</div>
				</div>
			</script>
			<hr width="96%">
			<div style="position: relative;width: 61%; margin: 0 auto;">
				
			    <div class="input-group">
			      <input type="text" class="form-control" id="msg">
			      <span class="input-group-btn">
			        <button class="btn btn-default" type="button" onclick="say()">发送</button>
			      </span>
				</div>
			</div>

	</div>
</div>
<script>
    var socket = io.connect('http://localhost:8080');
    var myid;
    socket.on('sendid',function (data) {
        myid = data.id;
        socket.emit('getname',{});
    });
    socket.on('welcome',function (data) {
        if (data.msg == myid) {
            document.getElementById('content').innerHTML += '<p>You join the chat!<p>';
        } else {
            document.getElementById('content').innerHTML += '<p>A new man join us! His ID is '+data.msg+'<p>';
        }
    });
    function say() {
        if (document.getElementById('msg').value != '')
            socket.emit('say',{msg:document.getElementById('msg').value});
        else
            alert("输入内容不能为空！");
        var div = document.getElementById("content");
            div.scrollTop = div.scrollHeight;
    }
    socket.on('sayall',function (data) {
        if (data.user == myid) {
        	var html = template('mysay',data);
            document.getElementById('content').innerHTML += html;
		} else {
            var html = template('othersay',data);
            document.getElementById('content').innerHTML += html;
		}
		var div = document.getElementById("content");
            div.scrollTop = div.scrollHeight;
    })
</script>
</body>
</html>