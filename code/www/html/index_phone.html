<!DOCTYPE html>
<!--suppress HtmlUnknownTarget -->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>聊天室</title>
    <script type="text/javascript" src="../js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="../js/index.js"></script>
    <script type="text/javascript" src="../dist/js/bootstrap.min.js"></script>
    <link href="../css/index.css" rel='stylesheet' type='text/css' />
    <link href="../dist/css/bootstrap.css" rel='stylesheet' type='text/css' />
    <script src="../js/template.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<!--电脑端界面-->
<body  style="margin: 0;padding: 0;
    background: url(../image/login-bg.png) center center / cover no-repeat
    fixed;height: 100%;"  onkeydown="msgSend();">
<div class="allDiv ">
    <div style="margin-right:-30px;">
        <div class="navBar row" style="background: url(../image/headerline.png) center center / cover no-repeat
        fixed;height:100%;width: 100%;">
            <div class="col-md-1">
                <span class="changeToCircle"><img style="width:100%;height:100%;" border="0" src="../image/Profile pic.png" alt="your profile picture"  hspace="20" vspace="15"></span></div>
            <div class="col-md-2 col-md-offset-1"  style="margin-top: 22px;">
                <h2>
                    <small style="color: white">昵称</small></h2>
            </div>
            <div class="col-md-1 col-md-offset-1 " >
                <img class="circular--square"  style="width: 80px;height: 80px;" src="../image/friendPic.png" alt="friend picture" hspace="5" vspace="25"></div>
            <div class="col-md-3 col-md-offset-1" style="margin-top: 22px;">
                <h1 >
                    <small style="color: white">聊天室</small></h1>
            </div>
            <div class="col-md-1">
                <img onclick="paperBtn()" border="0" src="../image/Paper.png" alt="paper" hspace="35" vspace="5" style="margin-top: 50px;margin-left: 20px;width: 30px;height: 30px;"></div>
            <div class="col-md-1">
                <img class="circular--square" onclick="settingBtn()" border="0" src="../image/Setting.png" alt="your profile picture" hspace="35" vspace="5" style="margin-top: 50px;margin-left: 18px;width: 30px;height: 30px;"></div>
        </div>
    </div>
    <div class="row">
        <div class="friendList col-md-3">
            <div class="col-xs-6 col-sm-6">
                <img class="circular--square"  style="width: 80px;height: 80px;" border="0" src="../image/friendPic.png" alt="friend picture" hspace="0"  vspace="25">
            </div>
            <div class="col-xs-6 col-sm-6" style="padding-top: 12px;">
                <h4 >
                    <small style="color:#8aba56">遗世独立的理想乡</small></h4>
                <h4>
                    <small style="color:#A9A9A9 ">水水水水</small></h4>
                <h4>
                    <small style="color: black">2016.10.10</small></h4>
            </div>
            <hr width="100%" >
        </div>
        <div class="chatList col-md-9">

            <div id="content" style="overflow:scroll;overflow-x: hidden; height: 80%;text-align: center;"></div>
            <script id="othersay" type="text/html">
                <div class="row">
                    <div class="col-sm-2" >
                        <img class="circular--square"  style="width: 80px;height: 80px;" border="0" src="../image/friendPic.png" alt="friend picture"   vspace="30">
                    </div>
                    <div class=" col-sm-10" style="padding-top: 12px;width: 64%;">
                        <h4 style="text-align: left;">
                            <small style="color:#8aba56;">{{user}}</small> <small style="color: black">{{date | dateFormat:'yyyy年 MM月 dd日 hh:mm:ss'}}</small></h4>

                        <p style="color: black;background-color: #f1f5f8;padding: 10px;border-radius: 8px;text-align: left;word-wrap: break-word;word-break: break-all;">{{msg}}</p>
                    </div>
                </div>
            </script>
            <script id="mysay" type="text/html">
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-10" style="padding-top: 12px;width: 64%;">
                        <h4 style="text-align: right;">
                            <small style="color: black;">{{date | dateFormat:'yyyy年 MM月 dd日 hh:mm:ss'}}</small><small style="color:#8aba56">{{user}}</small> </h4>

                        <p style="color: black;background-color: #f1f5f8;padding: 10px;border-radius: 8px;text-align: left;word-wrap: break-word;word-break: break-all;">{{msg}}</p>
                    </div>
                    <div class="col-sm-2">
                        <img class="circular--square"  style="width: 80px;height: 80px;" border="0" src="../image/friendPic.png" alt="friend picture"  vspace="30">
                    </div>
                </div>
            </script>
            <!-- tip类型 -->
            <script id="notesay" type="text/html">
               <div style="text-align: center;">
                    <h6 style="padding: 10px;">
                            <small style="color: white;background-color:#c1c6c9;padding: 5px;border-radius: 5px; ">欢迎{{msg}}的到来</small></h6>
               </div>
            </script>

            <hr width="96%">
            <div style="position: relative;width: 61%; margin: 0 auto;">
                
                <div class="input-group">
                    <label for="msg"></label><input type="text" class="form-control" id="msg">
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="button" id="msgSendBtn" onclick="say()">发送</button>
                  </span>
                </div>
            </div>

    </div>
</div>
</div>
<script>
    template.helper('dateFormat', function (date, format) {

        date = new Date(date);

        var map = {
            "M": date.getMonth() + 1, //月份
            "d": date.getDate(), //日
            "h": date.getHours(), //小时
            "m": date.getMinutes(), //分
            "s": date.getSeconds(), //秒
            "q": Math.floor((date.getMonth() + 3) / 3), //季度
            "S": date.getMilliseconds() //毫秒
        };
        format = format.replace(/([yMdhmsqS])+/g, function(all, t){
            var v = map[t];
            if(v !== undefined){
                if(all.length > 1){
                    v = '0' + v;
                    v = v.substr(v.length-2);
                }
                return v;
            }
            else if(t === 'y'){
                return (date.getFullYear() + '').substr(4 - all.length);
            }
            return all;
        });
        return format;
    });

    // --------

    var data = {
        date: (new Date).toString(),
    };


    var socket = io.connect('http://localhost:8080');
    var myid;
    socket.on('sendid',function (data) {
        myid = data.id;
        socket.emit('getname',{});
    });
    socket.on('welcome',function (data) {
        if (data.msg == myid) {
            var html = template('notesay',data);
            document.getElementById('content').innerHTML += html;
        } else {
            var html = template('notesay',data);
            document.getElementById('content').innerHTML += html;
        }
    });
    function say() {
        if (document.getElementById('msg').value != '')
            socket.emit('say',{msg:document.getElementById('msg').value});
        else
            alert("输入内容不能为空！");
    }
    socket.on('sayall',function (data) {
        if (data.user == myid) {
            var html = template('mysay',data);
            document.getElementById('content').innerHTML += html;
        } else {
            var html = template('othersay',data);
            document.getElementById('content').innerHTML += html;
        }
        // 定位到消息底部
        var div = document.getElementById("content");
            div.scrollTop = div.scrollHeight;
    })
</script>



<!--手机端界面-->
<!--<div class="allDiv-phone visible-xs" >-->
    <!--<div style="margin-right:-5%;">-->
        <!--<div class="navBar row  " style="background: url(../image/headerline.png) center center / cover no-repeat-->
        <!--fixed;height:100%;width: 100%;">-->
            <!--<div class="col-xs-1">-->
                <!--<span class="changeToCircle"><img style="width: 40px;height: 40px;" border="0" src="../image/Profile pic.png" alt="your profile picture"  hspace="20" vspace="15"></span></div>-->
            <!--<div class="col-xs-2 col-xs-offset-2"  style="margin-top: 10px;">-->
                <!--<h5><small style="color: white">昵称</small></h5>-->
            <!--</div>-->

            <!--<div class="col-xs-1">-->
                <!--<img onclick="paperBtn()" border="0" src="../image/Paper.png" alt="paper" hspace="35" vspace="5" style="margin-top: 50px;margin-left: 20px;width: 20px;height: 20px;"></div>-->
            <!--<div class="col-xs-1">-->
                <!--<img class="circular&#45;&#45;square" onclick="settingBtn()" border="0" src="../image/Setting.png" alt="your profile picture" hspace="35" vspace="5" style="margin-top: 50px;margin-left: 18px;width: 20px;height: 20px;"></div>-->
        <!--</div>-->
    <!--</div>-->
    <!--<div class="row">-->
        <!--<div class="friendList col-xs-12 hidden">-->
            <!--<div class="col-xs-6 col-sm-6">-->
                <!--<img class="circular&#45;&#45;square"  style="width: 80px;height: 80px;" border="0" src="../image/friendPic.png" alt="friend picture" hspace="0"  vspace="25">-->
            <!--</div>-->
            <!--<div class="col-xs-6 col-sm-6" style="padding-top: 12px;">-->
                <!--<h4 >-->
                    <!--<small style="color:#8aba56">遗世独立的理想乡</small></h4>-->
                <!--<h4>-->
                    <!--<small style="color:#A9A9A9 ">水水水水</small></h4>-->
                <!--<h4>-->
                    <!--<small style="color: black">2016.10.10</small></h4>-->
            <!--</div>-->
            <!--<hr width="100%" >-->
        <!--</div>-->
        <!--<div class="chatList col-xs-12 ">-->

            <!--<div id="content" style="overflow:scroll;overflow-x: hidden; height: 80%;text-align: center;"></div>-->
            <!--<script id="othersay" type="text/html">-->
                <!--<div class="row">-->
                    <!--<div class="col-sm-2" >-->
                        <!--<img class="circular&#45;&#45;square"  style="width: 80px;height: 80px;" border="0" src="../image/friendPic.png" alt="friend picture"   vspace="30">-->
                    <!--</div>-->
                    <!--<div class=" col-sm-10" style="padding-top: 12px;width: 64%;">-->
                        <!--<h4 style="text-align: left;">-->
                            <!--<small style="color:#8aba56;">{{user}}</small> <small style="color: black">{{date | dateFormat:'yyyy年 MM月 dd日 hh:mm:ss'}}</small></h4>-->

                        <!--<p style="color: black;background-color: #f1f5f8;padding: 10px;border-radius: 8px;text-align: left;word-wrap: break-word;word-break: break-all;">{{msg}}</p>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</script>-->
            <!--<script id="mysay" type="text/html">-->
                <!--<div class="row">-->
                    <!--<div class="col-sm-2"></div>-->
                    <!--<div class="col-sm-10" style="padding-top: 12px;width: 64%;">-->
                        <!--<h4 style="text-align: right;">-->
                            <!--<small style="color: black;">{{date | dateFormat:'yyyy年 MM月 dd日 hh:mm:ss'}}</small><small style="color:#8aba56">{{user}}</small> </h4>-->

                        <!--<p style="color: black;background-color: #f1f5f8;padding: 10px;border-radius: 8px;text-align: left;word-wrap: break-word;word-break: break-all;">{{msg}}</p>-->
                    <!--</div>-->
                    <!--<div class="col-sm-2">-->
                        <!--<img class="circular&#45;&#45;square"  style="width: 80px;height: 80px;" border="0" src="../image/friendPic.png" alt="friend picture"  vspace="30">-->
                    <!--</div>-->
                <!--</div>-->
            <!--</script>-->
            <!--&lt;!&ndash; tip类型 &ndash;&gt;-->
            <!--<script id="notesay" type="text/html">-->
                <!--<div style="text-align: center;">-->
                    <!--<h6 style="padding: 10px;">-->
                        <!--<small style="color: white;background-color:#c1c6c9;padding: 5px;border-radius: 5px; ">欢迎{{msg}}的到来</small></h6>-->
                <!--</div>-->
            <!--</script>-->

            <!--<hr width="96%">-->
            <!--<div style="position: relative;width: 61%; margin: 0 auto;">-->

                <!--<div class="input-group">-->
                    <!--<label for="msg"></label><input type="text" class="form-control" id="msg">-->
                    <!--<span class="input-group-btn">-->
                    <!--<button class="btn btn-default" type="button" id="msgSendBtn" onclick="say()">发送</button>-->
                  <!--</span>-->
                <!--</div>-->
            <!--</div>-->

        <!--</div>-->
    <!--</div>-->
<!--</div>-->



</body>


</html>